# FreeBSDで高可用性ファイルサーバー構築の概要

## これはなに？
FreeBSDを用いた高可用性ファイルサーバーの構築に関しては、日本語情報が少なめです。  
ですから、自分の忘備録を兼ねてこちらにconfig等のファイルや検証結果を残しておき、共有しようという試みです。

## このプロジェクトの意義
　わたくし、[りもこ](https://twitter.com/limonene_citrus)は、塾のほかに[明美教育テクノソリューションズ](http://aktk-tech.net/)という会社を営んでおります。  
　 <br>　教育支援事業は授業録画の動画ファイルや参考文献、塾作成のプリントなど、多数の大きなサイズのファイルを扱うため、一般的なクラウドサービスがやや使いにくいという事情があります。大きなファイル（動画素材など）はアップロードに時間がかかったり、アップロード時にファイルが壊れてしまうことも（比較的稀ではあるものの）あり、ファイル管理に苦慮していました。これまで、サイズが大きなファイルが混在すると、クラウドとの同期がうまくいかない場合もありました。  
　ファイルを保管するために、決して無視ができない金額の月間サブスクリプションを契約し続けることも、経営という視点で考えれば「何かないものか」と思わざるを得ない状況だったのです。  
　<br>　確かに、世の中のクラウドサービス（PaaS）はそれのよさがあることも事実です。ものにもよりますが、基本的にはセキュアですし、データがロストする可能性も（オンプレよりは）低いことは事実でしょう。教育支援事業は生徒に関するセンシティブなデータを扱うことも多く、セキュアに保存すべきファイルも存在することは事実です。  
　とはいえ、それでもファイルサーバーがオンプレミスで用意できることの利点は大きいものだと思います。データによってはクラウドに保存すべき（したほうがよい）ものがある一方で、上記のような問題もあり、オンプレで管理できる環境があることも大切なことです。つまり、オンプレとクラウドはケース・バイ・ケースで相互に補完しあう関係であり、どちらかが一方的に優れているというわけでもないのです。  
　<br>　しかし、どうでしょう？市販のNASはけっして堅牢とは言えず、必ずしも欲しい機能があるわけではないではありませんか！！  
　<br>　ここで、りもこの「エンジニアスピリッツ」に火が付いたわけです。  
　<br>　 *そう、無いものは作ればよい。  
　<br>　シンプルに、ただ、それだけです。*

## システム名称と命名規則
名付けて**うなぎ㌠** です！  
   * 各ノードの命名はUNA-[数字]とします。
>　うなぎの由来は、ネットワーク構築等に多大な協力を賜った、普段りもこと仲良くしてくださっている、うなぎ王子さんへのリスペクトです。多謝！！

## 検証環境を構築する意義
1. hyper-vを用いた検証環境で使用技術の向上と挙動確認
2. 実装された最新機能の随時テスト  
  従って、この検証環境は恒久的に使えるようにしておきます。


## 使用する主なOS
1. FreeBSD 13.0
2. TrueNAS Scale
3. Truecommand
4. Ubuntu 22.04 LTS(Server)  
   ※Ubuntu上のdockerにTruecommandを入れて運用する予定

## ファイルサーバーで使用する主な技術
1. CARP(Common Adress Redundancy Protocol)  
   複数のサーバでIPアドレスを共有し、冗長化を実現するためのプロトコル  
2. HAST(Highly Available Storage)  
   2台のサーバ間でファイルシステムを同期して、高可用性ストレージを実現する技術  
3. Rgular file Filesystem  
   単一ファイルをファイルシステムとして使う技術  

# A.検証環境について
* [検証環境について](https://github.com/limonene213u/FreeBSD/blob/main/test_env/readme.md)に移動しました。
# B.本番環境について（予定）
「いま現在、別の本番環境で使用している機材のほうが使用感が分かって良い」という認識のもと、これらの機材を使うことを想定しています。もっと実用に適した機材が見つかった場合、機材は変更になる可能性があります。
## 使用機材
* HPE DL360e Gen8  
  Xeon E5-2670 V2×2（20C40T）  
  RAM:80GB  
  Strage：2TB（Full SSD、RAID6）
  >FreeBSD用に2台使用します
* HPE ML310e Gen8 V2    
  Xeon E3-1280 V3（4C8T）  
  RAM：32GB  
  Strage：4TB（SAS HDD、RAID-Z）
  >TrueNAS Scale用に3台使用します
* AlliedTelesis AT-X510-28GTX
  >コアスイッチ
